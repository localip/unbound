"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"default",{enumerable:!0,get:()=>AddonCard});const a=require("../../components/discord"),b=require("../../modules/webpack/common"),c=require("../../../common/utilities/index"),d=function _interopRequireWildcard(a,b){if(!b&&a&&a.__esModule)return a;if(null===a||"object"!=typeof a&&"function"!=typeof a)return{default:a};var c=_getRequireWildcardCache(b);if(c&&c.has(a))return c.get(a);var d={},e=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in a)if("default"!==f&&Object.prototype.hasOwnProperty.call(a,f)){var g=e?Object.getOwnPropertyDescriptor(a,f):null;g&&(g.get||g.set)?Object.defineProperty(d,f,g):d[f]=a[f]}return d.default=a,c&&c.set(a,d),d}(require("../../api/toasts")),e=require("../../modules/webpack/api"),f=require("../../components/index"),g=_interopRequireDefault(require("../../modules/react")),h=require("./Icons/index"),i=_interopRequireDefault(require("../../styles/panels/addoncard.css"));function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _getRequireWildcardCache(a){if("function"!=typeof WeakMap)return null;var b=new WeakMap,c=new WeakMap;return(_getRequireWildcardCache=function(a){return a?c:b})(a)}i.default.append();class AddonCard extends g.default.Component{componentWillMount(){let a=this.getGlobal(),b=this.getType(),c=window[a]?.[b]??window[a]?.managers?.[b];c?.on?.("toggle",this.onToggle)}componentWillUnmount(){let a=this.getGlobal(),b=this.getType(),c=window[a]?.[b]??window[a]?.managers?.[b];c?.off?.("toggle",this.onToggle)}render(){let{entity:e,client:h,resolve:i}=this.props,j=i(e,h,"author",{raw:!0}),k=i(e,h,"description"),l=i(e,h,"version"),m=i(e,h,"color"),n=i(e,h,"name");return g.default.createElement(a.Tooltip,{position:"left",text:e.failed?b.Locale.Messages[`UNBOUND_ADDON_FAILED_${this.props.type.toUpperCase()}`]:null,hideOnClick:!1},g.default.createElement("div",{className:(0,c.classnames)("unbound-addon-card",e.failed&&"disabled"),style:{"--entity-color":m},onContextMenu:c=>b.ContextMenu.openContextMenu(c,()=>g.default.createElement(a.Menu.default,{onClose:b.ContextMenu.closeContextMenu},g.default.createElement(a.Menu.MenuItem,{id:"delete",color:"colorDanger",label:b.Locale.Messages.UNBOUND_DELETE,action:()=>{try{this.delete()}catch(a){d.open({title:b.Locale.Messages.UNBOUND_ADDON_FAILED_DELETE,content:b.Locale.Messages.UNBOUND_ADDON_FAILED_DELETE_DESC.format({addon:n}),icon:"Close",color:"var(--info-danger-foreground)",timeout:3500})}}}),g.default.createElement(a.Menu.MenuItem,{id:"reload",label:b.Locale.Messages.UNBOUND_RELOAD,action:()=>{try{this.reload(),d.open({title:b.Locale.Messages.UNBOUND_ADDON_RELOADED,content:b.Locale.Messages.UNBOUND_ADDON_RELOADED_DESC.format({addon:n}),timeout:2500,icon:"CheckmarkCircle",color:"var(--info-positive-foreground)"})}catch(a){d.open({title:b.Locale.Messages.UNBOUND_ADDON_FAILED_RELOAD,content:b.Locale.Messages.UNBOUND_ADDON_FAILED_RELOAD_DESC.format({addon:n}),icon:"Close",color:"var(--info-danger-foreground)",timeout:3500})}}})))},g.default.createElement("div",{className:"unbound-addon-header"},g.default.createElement(a.Text,{className:"unbound-addon-name",size:a.Text.Sizes.SIZE_16},n),g.default.createElement(a.Text,{className:"unbound-addon-version",size:a.Text.Sizes.SIZE_16,color:a.Text.Colors.INTERACTIVE_NORMAL},l),g.default.createElement(a.Text,{className:"unbound-addon-authors",size:a.Text.Sizes.SIZE_16,color:a.Text.Colors.INTERACTIVE_NORMAL},"by ",this.renderAuthors(j)),g.default.createElement("div",{className:"unbound-addon-controls"},"unbound"!==this.props.client&&g.default.createElement(a.RelativeTooltip,{text:b.Locale.Messages[`UNBOUND_ADDON_MANAGER_${this.props.client.toUpperCase()}_TOOLTIP`]?.format({type:"Plugin"}),hideOnClick:!1},a=>this.renderType({...a})),this.hasSettings()&&g.default.createElement(a.RelativeTooltip,{text:b.Locale.Messages.UNBOUND_SETTINGS,hideOnClick:!1},a=>g.default.createElement(f.Icon,Object.assign({},a,{onClick:()=>this.props.openSettings(),"data-is-disabled":!this.isEnabled,name:"Gear",width:28,height:28,className:"unbound-addon-control-button"}))),g.default.createElement(a.Switch,{checked:this.isEnabled,onChange:()=>this.toggle(),className:"unbound-addon-switch"}))),g.default.createElement("div",{className:"unbound-addon-footer"},g.default.createElement(a.FormText,{className:"unbound-addon-description"},g.default.createElement(a.Markdown,null,k)))))}renderAuthors(c){let d=[],handleAuthor=c=>{if("string"==typeof c)d.push(c);else if("object"==typeof c&&c.name){let f=typeof c.id||typeof c.discord_id,h=f&&["number","string"].includes(typeof f);d.push(h?g.default.createElement(a.Anchor,{className:"unbound-addon-author",async onClick(){let a=c.id??c.discord_id;await e.Users?.getUser(a),b.Dispatcher.wait(()=>b.Dispatcher.dispatch({type:"USER_PROFILE_MODAL_OPEN",userId:a}))}},c.name):c.name)}};return Array.isArray(c)?c.map(handleAuthor):"object"==typeof c&&c.name?handleAuthor(c):"string"==typeof c&&d.push(c),d.map((a,b)=>{let c=b+1===d.length;return"string"==typeof a?c?a:`${a}, `:[a,c?"":", "]})}renderType(a){let{client:b}=this.props;switch(a.className??="unbound-addon-type-icon",a.width??=16,a.height??=16,b){case"bd":return g.default.createElement(h.Bd,Object.assign({},a));case"powercord":return g.default.createElement(h.Plug,Object.assign({},a));default:return null}}get isEnabled(){let a=this.getId(),b=this.getGlobal(),c=this.getType(),d=window[b]?.[c]??window[b]?.managers?.[c];return d?.isEnabled?.(a)}delete(){let a=this.getId(),b=this.getGlobal(),c=this.getType(),d=window[b]?.[c]??window[b]?.managers?.[c];return d?.delete?.(a)}toggle(){let a=this.getId(),b=this.getGlobal(),c=this.getType(),d=window[b]?.[c]??window[b]?.managers?.[c];return d?.toggle?.(a)}reload(){let a=this.getId(),b=this.getGlobal(),c=this.getType(),d=window[b]?.[c]??window[b]?.managers?.[c];return d?.reload?d.reload(a):d?.remount?d.remount(a):void 0}onToggle(a){let{entity:b}=this.props;[b.id,b.entityID,b.name].includes(a)&&this.forceUpdate()}getType(){let{type:a,client:b}=this.props;switch(b){case"powercord":return"plugins"===a?"pluginManager":"styleManager";case"bd":return"plugins"===a?"Plugins":"Themes";case"unbound":return"plugins"===a?"plugins":"themes"}}getGlobal(){let{client:a}=this.props;switch(a){case"powercord":return"powercord";case"bd":return"BdApi";case"unbound":return"unbound"}}hasSettings(){let{client:a,entity:b}=this.props,c=this.getId();switch(a){case"powercord":let d=powercord.api.settings.settings;if(d.has(c))return!0;let e=[...d.values()];return e.find(a=>{let b=[a.label,a.category];if(b.includes(c))return!0});case"unbound":case"bd":return b.instance?.getSettingsPanel}}getId(){let{client:a,entity:b}=this.props;switch(a){case"powercord":return b.entityID;case"bd":return b.name;case"unbound":return b.id}}}!function(a,b,c,d){var e,f=arguments.length,g=f<3?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)(e=a[h])&&(g=(f<3?e(g):f>3?e(b,c,g):e(b,c))||g);return f>3&&g&&Object.defineProperty(b,c,g),g}([c.bind],AddonCard.prototype,"onToggle",null)