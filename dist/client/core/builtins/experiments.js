"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),!function _export(a,b){for(var c in b)Object.defineProperty(a,c,{enumerable:!0,get:b[c]})}(exports,{data:()=>e,initialize:()=>initialize,shutdown:()=>shutdown});const a=require("../../modules/webpack/common"),b=require("../../modules/webpack/stores"),c=require("../../modules/patcher/index"),d=(0,c.create)("unbound-experiments"),e={name:"Experiments",id:"dev.experiments",default:!1,restart:!0,wait:!1,cancelled:!1};async function initialize(){e.cancelled=!1;let c=Object.values(a.Dispatcher._actionHandlers._dependencyGraph.nodes);if(e.cancelled)return;let f=d.after(b.Users,"getCurrentUser",(a,b,c)=>{if(c)return new Proxy({},{get:(a,b)=>"hasFlag"===b?function(a){return 1===a||c.hasFlag.call(this,a)}:c[b]})});function onDispatch(){let d=c.find(a=>"ExperimentStore"===a.name);d&&d.actionHandler.CONNECTION_OPEN({type:"CONNECTION_OPEN",guildExperiments:[],experiments:[],user:{...b.Users.getCurrentUser(),flags:1}});let e=c.find(a=>"DeveloperExperimentStore"===a.name);e&&e.actionHandler.CONNECTION_OPEN(),a.Dispatcher.unsubscribe("CONNECTION_OPEN",onDispatch),f()}b.Users.getCurrentUser()?onDispatch():a.Dispatcher.subscribe("CONNECTION_OPEN",onDispatch)}function shutdown(){e.cancelled=!0,d.unpatchAll()}