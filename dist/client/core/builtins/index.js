"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),!function _export(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(exports,{initialize:()=>initialize,shutdown:()=>shutdown,start:()=>start,stop:()=>stop});const e=require("../../api/modals"),t=require("../../../common/logger"),a=_interopRequireWildcard(require("../../../common/settings")),i=require("../../modules/webpack/common"),r=_interopRequireWildcard(require("./registry")),n=require("../../../common/utilities/index");function _getRequireWildcardCache(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(_getRequireWildcardCache=function(e){return e?a:t})(e)}function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=_getRequireWildcardCache(t);if(a&&a.has(e))return a.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var o=r?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(i,n,o):i[n]=e[n]}return i.default=e,a&&a.set(e,i),i}const o=(0,t.createLogger)("Built-In"),s=(0,n.debounce)(onSettingsChange,250),d={};async function initialize(){a.on("change",s);let e=Object.keys(r);for(let t=0;t<e.length;t++){let i=e[t];await start(i)}}async function shutdown(){a.off("change",s);let e=Object.keys(r);for(let t=0;t<e.length;t++){let i=e[t];await stop(i)}}async function start(e){let t=r[e];if(a.get("unbound",t.data.id,t.data.default)&&!d[t.data.id]&&t)try{t.data.wait?await t.initialize?.():t.initialize?.(),d[t.data.id]=!0,o.log(`${t.data.name} was initialized.`)}catch(i){o.error(`Failed to start ${t.data.name}.`,i.message)}}async function stop(e){let t=r[e];if(d[t.data.id]&&t)try{t.data.wait?await t.shutdown?.():t.shutdown?.(),delete d[t.data.id],o.log(`${t.data.name} was stopped.`)}catch(a){o.error(`Failed to stop ${t.data.name}.`,a.message)}}async function onSettingsChange({key:t,value:a}){let n=Object.entries(r).find(([,e])=>e.data.id===t);if(!n)return;let[o,s]=n;if(s.data.restart)return(0,e.showConfirmModal)({header:i.Locale.Messages.UNBOUND_RESTART,content:i.Locale.Messages.UNBOUND_RESTART_SETTING_DESC,confirmText:i.Locale.Messages.UNBOUND_RESTART,cancelText:i.Locale.Messages.CANCEL,onConfirm:()=>window.location.reload()});a?await start(o):await stop(o)}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jbGllbnQvY29yZS9idWlsdGlucy9pbmRleC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBzaG93Q29uZmlybU1vZGFsIH0gZnJvbSAnQGFwaS9tb2RhbHMnO1xyXG5pbXBvcnQgeyBjcmVhdGVMb2dnZXIgfSBmcm9tICdAY29tbW9uL2xvZ2dlcic7XHJcbmltcG9ydCAqIGFzIFNldHRpbmdzIGZyb20gJ0Bjb21tb24vc2V0dGluZ3MnO1xyXG5pbXBvcnQgeyBMb2NhbGUgfSBmcm9tICdAd2VicGFjay9jb21tb24nO1xyXG5pbXBvcnQgKiBhcyBCdWlsdElucyBmcm9tICcuL3JlZ2lzdHJ5JztcclxuaW1wb3J0IHsgZGVib3VuY2UgfSBmcm9tICdAdXRpbGl0aWVzJztcclxuXHJcbmNvbnN0IExvZ2dlciA9IGNyZWF0ZUxvZ2dlcignQnVpbHQtSW4nKTtcclxuXHJcbmNvbnN0IGhhbmRsZVNldHRpbmdzQ2hhbmdlID0gZGVib3VuY2Uob25TZXR0aW5nc0NoYW5nZSwgMjUwKTtcclxuXHJcbmludGVyZmFjZSBTZXR0aW5nc0NoYW5nZSB7XHJcbiAgIGtleTogc3RyaW5nO1xyXG4gICB2YWx1ZTogYm9vbGVhbjtcclxufVxyXG5cclxuaW50ZXJmYWNlIEJ1aWx0SW5EYXRhIHtcclxuICAgcmVzdGFydD86IGJvb2xlYW47XHJcbiAgIGRlZmF1bHQ6IGJvb2xlYW47XHJcbiAgIHdhaXQ/OiBib29sZWFuO1xyXG4gICBuYW1lOiBzdHJpbmcsXHJcbiAgIGlkOiBzdHJpbmcsXHJcbn1cclxuXHJcbmludGVyZmFjZSBJbnN0YW5jZSBleHRlbmRzIEJ1aWx0SW5EYXRhIHtcclxuICAgaW5pdGlhbGl6ZTogRm47XHJcbiAgIHNodXRkb3duOiBGbjtcclxuICAgW2tleTogc3RyaW5nXTogYW55O1xyXG59XHJcblxyXG5jb25zdCBzdGFydGVkOiBSZWNvcmQ8c3RyaW5nLCBib29sZWFuPiA9IHt9O1xyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGluaXRpYWxpemUoKSB7XHJcbiAgIFNldHRpbmdzLm9uKCdjaGFuZ2UnLCBoYW5kbGVTZXR0aW5nc0NoYW5nZSk7XHJcblxyXG4gICBjb25zdCBidWlsdGlucyA9IE9iamVjdC5rZXlzKEJ1aWx0SW5zKTtcclxuICAgZm9yIChsZXQgaSA9IDA7IGkgPCBidWlsdGlucy5sZW5ndGg7IGkrKykge1xyXG4gICAgICBjb25zdCBuYW1lID0gYnVpbHRpbnNbaV07XHJcbiAgICAgIGF3YWl0IHN0YXJ0KG5hbWUpO1xyXG4gICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzaHV0ZG93bigpIHtcclxuICAgU2V0dGluZ3Mub2ZmKCdjaGFuZ2UnLCBoYW5kbGVTZXR0aW5nc0NoYW5nZSk7XHJcblxyXG4gICBjb25zdCBidWlsdGlucyA9IE9iamVjdC5rZXlzKEJ1aWx0SW5zKTtcclxuICAgZm9yIChsZXQgaSA9IDA7IGkgPCBidWlsdGlucy5sZW5ndGg7IGkrKykge1xyXG4gICAgICBjb25zdCBuYW1lID0gYnVpbHRpbnNbaV07XHJcbiAgICAgIGF3YWl0IHN0b3AobmFtZSk7XHJcbiAgIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHN0YXJ0KG5hbWU6IHN0cmluZykge1xyXG4gICBjb25zdCBpbnN0YW5jZSA9IEJ1aWx0SW5zW25hbWVdO1xyXG5cclxuICAgaWYgKCFTZXR0aW5ncy5nZXQoJ3VuYm91bmQnLCBpbnN0YW5jZS5kYXRhLmlkLCBpbnN0YW5jZS5kYXRhLmRlZmF1bHQpKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgfVxyXG5cclxuICAgaWYgKHN0YXJ0ZWRbaW5zdGFuY2UuZGF0YS5pZF0gfHwgIWluc3RhbmNlKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgfVxyXG5cclxuICAgdHJ5IHtcclxuICAgICAgaWYgKGluc3RhbmNlLmRhdGEud2FpdCkge1xyXG4gICAgICAgICBhd2FpdCBpbnN0YW5jZS5pbml0aWFsaXplPy4oKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgaW5zdGFuY2UuaW5pdGlhbGl6ZT8uKCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHN0YXJ0ZWRbaW5zdGFuY2UuZGF0YS5pZF0gPSB0cnVlO1xyXG4gICAgICBMb2dnZXIubG9nKGAke2luc3RhbmNlLmRhdGEubmFtZX0gd2FzIGluaXRpYWxpemVkLmApO1xyXG4gICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIExvZ2dlci5lcnJvcihgRmFpbGVkIHRvIHN0YXJ0ICR7aW5zdGFuY2UuZGF0YS5uYW1lfS5gLCBlLm1lc3NhZ2UpO1xyXG4gICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzdG9wKG5hbWU6IHN0cmluZykge1xyXG4gICBjb25zdCBpbnN0YW5jZSA9IEJ1aWx0SW5zW25hbWVdO1xyXG5cclxuICAgaWYgKCFzdGFydGVkW2luc3RhbmNlLmRhdGEuaWRdIHx8ICFpbnN0YW5jZSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgIH1cclxuXHJcbiAgIHRyeSB7XHJcbiAgICAgIGlmIChpbnN0YW5jZS5kYXRhLndhaXQpIHtcclxuICAgICAgICAgYXdhaXQgaW5zdGFuY2Uuc2h1dGRvd24/LigpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgICBpbnN0YW5jZS5zaHV0ZG93bj8uKCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGRlbGV0ZSBzdGFydGVkW2luc3RhbmNlLmRhdGEuaWRdO1xyXG4gICAgICBMb2dnZXIubG9nKGAke2luc3RhbmNlLmRhdGEubmFtZX0gd2FzIHN0b3BwZWQuYCk7XHJcbiAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgTG9nZ2VyLmVycm9yKGBGYWlsZWQgdG8gc3RvcCAke2luc3RhbmNlLmRhdGEubmFtZX0uYCwgZS5tZXNzYWdlKTtcclxuICAgfVxyXG59XHJcblxyXG5hc3luYyBmdW5jdGlvbiBvblNldHRpbmdzQ2hhbmdlKHsga2V5LCB2YWx1ZSB9OiBTZXR0aW5nc0NoYW5nZSkge1xyXG4gICBjb25zdCBwYXlsb2FkID0gT2JqZWN0LmVudHJpZXMoQnVpbHRJbnMpLmZpbmQoKFssIHZdKSA9PiB2LmRhdGEuaWQgPT09IGtleSk7XHJcbiAgIGlmICghcGF5bG9hZCkgcmV0dXJuO1xyXG5cclxuICAgY29uc3QgW2J1aWx0aW4sIGluc3RhbmNlXSA9IHBheWxvYWQgYXMgdW5rbm93biBhcyBbc3RyaW5nLCBJbnN0YW5jZV07XHJcblxyXG4gICBpZiAoaW5zdGFuY2UuZGF0YS5yZXN0YXJ0KSB7XHJcbiAgICAgIHJldHVybiBzaG93Q29uZmlybU1vZGFsKHtcclxuICAgICAgICAgaGVhZGVyOiBMb2NhbGUuTWVzc2FnZXMuVU5CT1VORF9SRVNUQVJULFxyXG4gICAgICAgICBjb250ZW50OiBMb2NhbGUuTWVzc2FnZXMuVU5CT1VORF9SRVNUQVJUX1NFVFRJTkdfREVTQyxcclxuICAgICAgICAgY29uZmlybVRleHQ6IExvY2FsZS5NZXNzYWdlcy5VTkJPVU5EX1JFU1RBUlQsXHJcbiAgICAgICAgIGNhbmNlbFRleHQ6IExvY2FsZS5NZXNzYWdlcy5DQU5DRUwsXHJcbiAgICAgICAgIG9uQ29uZmlybTogKCkgPT4gd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpXHJcbiAgICAgIH0pO1xyXG4gICB9O1xyXG5cclxuICAgaWYgKCF2YWx1ZSkge1xyXG4gICAgICBhd2FpdCBzdG9wKGJ1aWx0aW4pO1xyXG4gICB9IGVsc2Uge1xyXG4gICAgICBhd2FpdCBzdGFydChidWlsdGluKTtcclxuICAgfVxyXG59Il0sIm5hbWVzIjpbImluaXRpYWxpemUiLCJzaHV0ZG93biIsInN0YXJ0Iiwic3RvcCIsIkxvZ2dlciIsImNyZWF0ZUxvZ2dlciIsImhhbmRsZVNldHRpbmdzQ2hhbmdlIiwiZGVib3VuY2UiLCJvblNldHRpbmdzQ2hhbmdlIiwic3RhcnRlZCIsIlNldHRpbmdzIiwib24iLCJidWlsdGlucyIsIk9iamVjdCIsImtleXMiLCJCdWlsdElucyIsImkiLCJsZW5ndGgiLCJuYW1lIiwib2ZmIiwiaW5zdGFuY2UiLCJnZXQiLCJkYXRhIiwiaWQiLCJkZWZhdWx0Iiwid2FpdCIsImxvZyIsImUiLCJlcnJvciIsIm1lc3NhZ2UiLCJrZXkiLCJ2YWx1ZSIsInBheWxvYWQiLCJlbnRyaWVzIiwiZmluZCIsInYiLCJidWlsdGluIiwicmVzdGFydCIsInNob3dDb25maXJtTW9kYWwiLCJoZWFkZXIiLCJMb2NhbGUiLCJNZXNzYWdlcyIsIlVOQk9VTkRfUkVTVEFSVCIsImNvbnRlbnQiLCJVTkJPVU5EX1JFU1RBUlRfU0VUVElOR19ERVNDIiwiY29uZmlybVRleHQiLCJjYW5jZWxUZXh0IiwiQ0FOQ0VMIiwib25Db25maXJtIiwid2luZG93IiwibG9jYXRpb24iLCJyZWxvYWQiXSwibWFwcGluZ3MiOiJBQUFBLHdLQWdDc0JBLFVBQVUsS0FBVkEsVUFBVSxDQVVWQyxRQUFRLEtBQVJBLFFBQVEsQ0FVUkMsS0FBSyxLQUFMQSxLQUFLLENBeUJMQyxJQUFJLEtBQUpBLElBQUksbUJBN0VPLGtCQUFhLFlBQ2pCLHdCQUFnQixvQ0FDbkIsMEJBQWtCLGFBQ3JCLDhCQUFpQixvQ0FDZCxZQUFZLGFBQ2IsaUNBQVksMHBCQUVyQyxNQUFNQyxDQUFNLENBQUdDLEdBQUFBLENBQVksYUFBQSxFQUFDLFVBQVUsQ0FBQyxDQUVqQ0MsQ0FBb0IsQ0FBR0MsR0FBQUEsQ0FBUSxTQUFBLEVBQUNDLGdCQUFnQixDQUFFLEdBQUcsQ0FBQyxDQXFCdERDLENBQU8sQ0FBNEIsRUFBRSxBQXZCSCxBQXlCakMsZ0JBQWVULFVBQVUsRUFBRyxDQUNoQ1UsQ0FBUSxDQUFDQyxFQUFFLENBQUMsUUFBUSxDQUFFTCxDQUFvQixDQUFDLEFBRTNDLEtBQU1NLENBQVEsQ0FBR0MsTUFBTSxDQUFDQyxJQUFJLENBQUNDLENBQVEsQ0FBQyxBQUFDLEFBQ3ZDLEtBQUssSUFBSUMsQ0FBQyxDQUFHLENBQUMsQ0FBRUEsQ0FBQyxDQUFHSixDQUFRLENBQUNLLE1BQU0sQ0FBRUQsQ0FBQyxFQUFFLENBQUUsQ0FDdkMsSUFBTUUsQ0FBSSxDQUFHTixDQUFRLENB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