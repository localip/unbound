"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),!function(a,b){for(var c in b)Object.defineProperty(a,c,{enumerable:!0,get:b[c]})}(exports,{initialize:()=>l,shutdown:()=>m,start:()=>n,stop:()=>o});const a=require("../../api/modals"),b=require("../../../common/logger"),c=h(require("../../../common/settings")),d=require("../../modules/webpack/common"),e=h(require("./registry")),f=require("../../../common/utilities/index");function g(a){if("function"!=typeof WeakMap)return null;var b=new WeakMap,c=new WeakMap;return(g=function(a){return a?c:b})(a)}function h(a,b){if(!b&&a&&a.__esModule)return a;if(null===a||"object"!=typeof a&&"function"!=typeof a)return{default:a};var c=g(b);if(c&&c.has(a))return c.get(a);var d={},e=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in a)if("default"!==f&&Object.prototype.hasOwnProperty.call(a,f)){var h=e?Object.getOwnPropertyDescriptor(a,f):null;h&&(h.get||h.set)?Object.defineProperty(d,f,h):d[f]=a[f]}return d.default=a,c&&c.set(a,d),d}const i=(0,b.createLogger)("Built-In"),j=(0,f.debounce)(p,250),k={};async function l(){c.on("change",j);let a=Object.keys(e);for(let b=0;b<a.length;b++){let d=a[b];await n(d)}}async function m(){c.off("change",j);let a=Object.keys(e);for(let b=0;b<a.length;b++){let d=a[b];await o(d)}}async function n(a){let b=e[a];if(c.get("unbound",b.data.id,b.data.default)&& !k[b.data.id]&&b)try{b.data.wait?await b.initialize?.():b.initialize?.(),k[b.data.id]=!0,i.log(`${b.data.name} was initialized.`)}catch(d){i.error(`Failed to start ${b.data.name}.`,d.message)}}async function o(a){let b=e[a];if(k[b.data.id]&&b)try{b.data.wait?await b.shutdown?.():b.shutdown?.(),delete k[b.data.id],i.log(`${b.data.name} was stopped.`)}catch(c){i.error(`Failed to stop ${b.data.name}.`,c.message)}}async function p({key:b,value:c}){let f=Object.entries(e).find(([,a])=>a.data.id===b);if(!f)return;let[g,h]=f;if(h.data.restart)return(0,a.showConfirmModal)({header:d.Locale.Messages.UNBOUND_RESTART,content:d.Locale.Messages.UNBOUND_RESTART_SETTING_DESC,confirmText:d.Locale.Messages.UNBOUND_RESTART,cancelText:d.Locale.Messages.CANCEL,onConfirm:()=>window.location.reload()});c?await n(g):await o(g)}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jbGllbnQvY29yZS9idWlsdGlucy9pbmRleC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBzaG93Q29uZmlybU1vZGFsIH0gZnJvbSAnQGFwaS9tb2RhbHMnO1xyXG5pbXBvcnQgeyBjcmVhdGVMb2dnZXIgfSBmcm9tICdAY29tbW9uL2xvZ2dlcic7XHJcbmltcG9ydCAqIGFzIFNldHRpbmdzIGZyb20gJ0Bjb21tb24vc2V0dGluZ3MnO1xyXG5pbXBvcnQgeyBMb2NhbGUgfSBmcm9tICdAd2VicGFjay9jb21tb24nO1xyXG5pbXBvcnQgKiBhcyBCdWlsdElucyBmcm9tICcuL3JlZ2lzdHJ5JztcclxuaW1wb3J0IHsgZGVib3VuY2UgfSBmcm9tICdAdXRpbGl0aWVzJztcclxuXHJcbmNvbnN0IExvZ2dlciA9IGNyZWF0ZUxvZ2dlcignQnVpbHQtSW4nKTtcclxuXHJcbmNvbnN0IGhhbmRsZVNldHRpbmdzQ2hhbmdlID0gZGVib3VuY2Uob25TZXR0aW5nc0NoYW5nZSwgMjUwKTtcclxuXHJcbmludGVyZmFjZSBTZXR0aW5nc0NoYW5nZSB7XHJcbiAgIGtleTogc3RyaW5nO1xyXG4gICB2YWx1ZTogYm9vbGVhbjtcclxufVxyXG5cclxuaW50ZXJmYWNlIEJ1aWx0SW5EYXRhIHtcclxuICAgcmVzdGFydD86IGJvb2xlYW47XHJcbiAgIGRlZmF1bHQ6IGJvb2xlYW47XHJcbiAgIHdhaXQ/OiBib29sZWFuO1xyXG4gICBuYW1lOiBzdHJpbmcsXHJcbiAgIGlkOiBzdHJpbmcsXHJcbn1cclxuXHJcbmludGVyZmFjZSBJbnN0YW5jZSBleHRlbmRzIEJ1aWx0SW5EYXRhIHtcclxuICAgaW5pdGlhbGl6ZTogRm47XHJcbiAgIHNodXRkb3duOiBGbjtcclxuICAgW2tleTogc3RyaW5nXTogYW55O1xyXG59XHJcblxyXG5jb25zdCBzdGFydGVkOiBSZWNvcmQ8c3RyaW5nLCBib29sZWFuPiA9IHt9O1xyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGluaXRpYWxpemUoKSB7XHJcbiAgIFNldHRpbmdzLm9uKCdjaGFuZ2UnLCBoYW5kbGVTZXR0aW5nc0NoYW5nZSk7XHJcblxyXG4gICBjb25zdCBidWlsdGlucyA9IE9iamVjdC5rZXlzKEJ1aWx0SW5zKTtcclxuICAgZm9yIChsZXQgaSA9IDA7IGkgPCBidWlsdGlucy5sZW5ndGg7IGkrKykge1xyXG4gICAgICBjb25zdCBuYW1lID0gYnVpbHRpbnNbaV07XHJcbiAgICAgIGF3YWl0IHN0YXJ0KG5hbWUpO1xyXG4gICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzaHV0ZG93bigpIHtcclxuICAgU2V0dGluZ3Mub2ZmKCdjaGFuZ2UnLCBoYW5kbGVTZXR0aW5nc0NoYW5nZSk7XHJcblxyXG4gICBjb25zdCBidWlsdGlucyA9IE9iamVjdC5rZXlzKEJ1aWx0SW5zKTtcclxuICAgZm9yIChsZXQgaSA9IDA7IGkgPCBidWlsdGlucy5sZW5ndGg7IGkrKykge1xyXG4gICAgICBjb25zdCBuYW1lID0gYnVpbHRpbnNbaV07XHJcbiAgICAgIGF3YWl0IHN0b3AobmFtZSk7XHJcbiAgIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHN0YXJ0KG5hbWU6IHN0cmluZykge1xyXG4gICBjb25zdCBpbnN0YW5jZSA9IEJ1aWx0SW5zW25hbWVdO1xyXG5cclxuICAgaWYgKCFTZXR0aW5ncy5nZXQoJ3VuYm91bmQnLCBpbnN0YW5jZS5kYXRhLmlkLCBpbnN0YW5jZS5kYXRhLmRlZmF1bHQpKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgfVxyXG5cclxuICAgaWYgKHN0YXJ0ZWRbaW5zdGFuY2UuZGF0YS5pZF0gfHwgIWluc3RhbmNlKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgfVxyXG5cclxuICAgdHJ5IHtcclxuICAgICAgaWYgKGluc3RhbmNlLmRhdGEud2FpdCkge1xyXG4gICAgICAgICBhd2FpdCBpbnN0YW5jZS5pbml0aWFsaXplPy4oKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgaW5zdGFuY2UuaW5pdGlhbGl6ZT8uKCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHN0YXJ0ZWRbaW5zdGFuY2UuZGF0YS5pZF0gPSB0cnVlO1xyXG4gICAgICBMb2dnZXIubG9nKGAke2luc3RhbmNlLmRhdGEubmFtZX0gd2FzIGluaXRpYWxpemVkLmApO1xyXG4gICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIExvZ2dlci5lcnJvcihgRmFpbGVkIHRvIHN0YXJ0ICR7aW5zdGFuY2UuZGF0YS5uYW1lfS5gLCBlLm1lc3NhZ2UpO1xyXG4gICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzdG9wKG5hbWU6IHN0cmluZykge1xyXG4gICBjb25zdCBpbnN0YW5jZSA9IEJ1aWx0SW5zW25hbWVdO1xyXG5cclxuICAgaWYgKCFzdGFydGVkW2luc3RhbmNlLmRhdGEuaWRdIHx8ICFpbnN0YW5jZSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgIH1cclxuXHJcbiAgIHRyeSB7XHJcbiAgICAgIGlmIChpbnN0YW5jZS5kYXRhLndhaXQpIHtcclxuICAgICAgICAgYXdhaXQgaW5zdGFuY2Uuc2h1dGRvd24/LigpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgICBpbnN0YW5jZS5zaHV0ZG93bj8uKCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGRlbGV0ZSBzdGFydGVkW2luc3RhbmNlLmRhdGEuaWRdO1xyXG4gICAgICBMb2dnZXIubG9nKGAke2luc3RhbmNlLmRhdGEubmFtZX0gd2FzIHN0b3BwZWQuYCk7XHJcbiAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgTG9nZ2VyLmVycm9yKGBGYWlsZWQgdG8gc3RvcCAke2luc3RhbmNlLmRhdGEubmFtZX0uYCwgZS5tZXNzYWdlKTtcclxuICAgfVxyXG59XHJcblxyXG5hc3luYyBmdW5jdGlvbiBvblNldHRpbmdzQ2hhbmdlKHsga2V5LCB2YWx1ZSB9OiBTZXR0aW5nc0NoYW5nZSkge1xyXG4gICBjb25zdCBwYXlsb2FkID0gT2JqZWN0LmVudHJpZXMoQnVpbHRJbnMpLmZpbmQoKFssIHZdKSA9PiB2LmRhdGEuaWQgPT09IGtleSk7XHJcbiAgIGlmICghcGF5bG9hZCkgcmV0dXJuO1xyXG5cclxuICAgY29uc3QgW2J1aWx0aW4sIGluc3RhbmNlXSA9IHBheWxvYWQgYXMgdW5rbm93biBhcyBbc3RyaW5nLCBJbnN0YW5jZV07XHJcblxyXG4gICBpZiAoaW5zdGFuY2UuZGF0YS5yZXN0YXJ0KSB7XHJcbiAgICAgIHJldHVybiBzaG93Q29uZmlybU1vZGFsKHtcclxuICAgICAgICAgaGVhZGVyOiBMb2NhbGUuTWVzc2FnZXMuVU5CT1VORF9SRVNUQVJULFxyXG4gICAgICAgICBjb250ZW50OiBMb2NhbGUuTWVzc2FnZXMuVU5CT1VORF9SRVNUQVJUX1NFVFRJTkdfREVTQyxcclxuICAgICAgICAgY29uZmlybVRleHQ6IExvY2FsZS5NZXNzYWdlcy5VTkJPVU5EX1JFU1RBUlQsXHJcbiAgICAgICAgIGNhbmNlbFRleHQ6IExvY2FsZS5NZXNzYWdlcy5DQU5DRUwsXHJcbiAgICAgICAgIG9uQ29uZmlybTogKCkgPT4gd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpXHJcbiAgICAgIH0pO1xyXG4gICB9O1xyXG5cclxuICAgaWYgKCF2YWx1ZSkge1xyXG4gICAgICBhd2FpdCBzdG9wKGJ1aWx0aW4pO1xyXG4gICB9IGVsc2Uge1xyXG4gICAgICBhd2FpdCBzdGFydChidWlsdGluKTtcclxuICAgfVxyXG59Il0sIm5hbWVzIjpbImluaXRpYWxpemUiLCJzaHV0ZG93biIsInN0YXJ0Iiwic3RvcCIsIkxvZ2dlciIsImNyZWF0ZUxvZ2dlciIsImhhbmRsZVNldHRpbmdzQ2hhbmdlIiwiZGVib3VuY2UiLCJvblNldHRpbmdzQ2hhbmdlIiwic3RhcnRlZCIsIlNldHRpbmdzIiwib24iLCJidWlsdGlucyIsIk9iamVjdCIsImtleXMiLCJCdWlsdElucyIsImkiLCJsZW5ndGgiLCJuYW1lIiwib2ZmIiwiaW5zdGFuY2UiLCJnZXQiLCJkYXRhIiwiaWQiLCJkZWZhdWx0Iiwid2FpdCIsImxvZyIsImUiLCJlcnJvciIsIm1lc3NhZ2UiLCJrZXkiLCJ2YWx1ZSIsInBheWxvYWQiLCJlbnRyaWVzIiwiZmluZCIsInYiLCJidWlsdGluIiwicmVzdGFydCIsInNob3dDb25maXJtTW9kYWwiLCJoZWFkZXIiLCJMb2NhbGUiLCJNZXNzYWdlcyIsIlVOQk9VTkRfUkVTVEFSVCIsImNvbnRlbnQiLCJVTkJPVU5EX1JFU1RBUlRfU0VUVElOR19ERVNDIiwiY29uZmlybVRleHQiLCJjYW5jZWxUZXh0IiwiQ0FOQ0VMIiwib25Db25maXJtIiwid2luZG93IiwibG9jYXRpb24iLCJyZWxvYWQiXSwibWFwcGluZ3MiOiJBQUFBLGdLQWdDc0JBLFVBQVUsS0FBVkEsQ0FBVSxDQVVWQyxRQUFRLEtBQVJBLENBQVEsQ0FVUkMsS0FBSyxLQUFMQSxDQUFLLENBeUJMQyxJQUFJLEtBQUpBLENBQUksbUJBN0VPLGtCQUFhLFlBQ2pCLHdCQUFnQixjQUNuQiwwQkFBa0IsYUFDckIsOEJBQWlCLGNBQ2QsWUFBWSxhQUNiLGlDQUFZLCtqQkFFckMsTUFBTUMsQ0FBTSxDQUFHQyxHQUFBQSxDQUFZLGFBQUEsRUFBQyxVQUFVLENBQUMsQ0FFakNDLENBQW9CLENBQUdDLEdBQUFBLENBQVEsU0FBQSxFQUFDQyxDQUFnQixDQUFFLEdBQUcsQ0FBQyxDQXFCdERDLENBQU8sQ0FBNEIsRUFBRSxBQXZCSCxBQXlCakMsZ0JBQWVULENBQVUsRUFBRyxDQUNoQ1UsQ0FBUSxDQUFDQyxFQUFFLENBQUMsUUFBUSxDQUFFTCxDQUFvQixDQUFDLEFBRTNDLEtBQU1NLENBQVEsQ0FBR0MsTUFBTSxDQUFDQyxJQUFJLENBQUNDLENBQVEsQ0FBQyxBQUFDLEFBQ3ZDLEtBQUssSUFBSUMsQ0FBQyxDQUFHLENBQUMsQ0FBRUEsQ0FBQyxDQUFHSixDQUFRLENBQUNLLE1BQU0sQ0FBRUQsQ0FBQyxFQUFFLENBQUUsQ0FDdkMsSUFBTUUsQ0FBSSxDQUFHTixDQUFRLENBQUNJ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