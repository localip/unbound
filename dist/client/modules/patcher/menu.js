"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),!function _export(a,b){for(var c in b)Object.defineProperty(a,c,{enumerable:!0,get:b[c]})}(exports,{patches:()=>f,before:()=>before,after:()=>after,instead:()=>instead,create:()=>create,unpatchAll:()=>unpatchAll,default:()=>g});const a=require("../../../common/logger"),b=require("../../../common/utilities/index"),c=function _interopRequireWildcard(a,b){if(!b&&a&&a.__esModule)return a;if(null===a||"object"!=typeof a&&"function"!=typeof a)return{default:a};var c=_getRequireWildcardCache(b);if(c&&c.has(a))return c.get(a);var d={},e=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in a)if("default"!==f&&Object.prototype.hasOwnProperty.call(a,f)){var g=e?Object.getOwnPropertyDescriptor(a,f):null;g&&(g.get||g.set)?Object.defineProperty(d,f,g):d[f]=a[f]}return d.default=a,c&&c.set(a,d),d}(require("@webpack")),d=function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}(require("./index"));function _getRequireWildcardCache(a){if("function"!=typeof WeakMap)return null;var b=new WeakMap,c=new WeakMap;return(_getRequireWildcardCache=function(a){return a?c:b})(a)}const e=(0,a.createLogger)("Patcher","Menu"),f={};function before(a,b,c){validateArguments(a,b,c),push("before",a,b,c)}function after(a,b,c){validateArguments(a,b,c),push("after",a,b,c)}function instead(a,b,c){validateArguments(a,b,c),push("instead",a,b,c)}function create(a){return{before:(b,c)=>before(a,b,c),after:(b,c)=>after(a,b,c),instead:(b,c)=>instead(a,b,c),unpatchAll:()=>unpatchAll(a)}}function unpatchAll(a){for(let b in f){let c=f[b];f[b]=c.filter(b=>b.caller!==a)}return d.default.unpatchAll(a)}function validateArguments(a,b,c){if(a&&"string"==typeof a){if(b&&"string"==typeof b){if(!c||"function"!=typeof c)throw TypeError("third argument callback does not exist or is not of type function")}else throw TypeError("second argument menu does not exist or is not of type string")}else throw TypeError("first argument caller does not exist or is not of type string")}function push(a,b,c,d){f[c]??=[],f[c].push({type:a,caller:b,menu:c,callback:d,applied:!1})}function initialize(){let a=c.findByProps("openContextMenuLazy");d.default.instead("unbound-menu-patcher",a,"openContextMenuLazy",(a,c,g)=>{if(!c[1].__unbound){let h=c[1];c[1]=async(...a)=>{let c=await h(a[0]);return a=>(function handleMenu(a,c){let g=c(a);try{if(g.type.displayName?.endsWith("ContextMenu")){let h=g.type?.displayName,i=f[h];if(!i?.length)return g;for(let j of i)d.default[j.type](j.caller,g,"type",(a,b,c)=>{try{return j.callback.apply(a,[a,b,c])}catch(d){e.error(`Failed to run context menu patch on ${h} of caller ${j.caller}.`,d)}},!0);return g}let k=(0,b.forceRender)(g.type)(g.props);if(!k)return g;let l=k.props.children;if(l.type?.displayName?.endsWith("ContextMenu")){let m=l.type?.displayName,n=f[m];if(!n?.length)return g;for(let o of n)d.default[o.type](o.caller,l,"type",(a,b,c)=>{try{return o.callback.apply(a,[a,b,c])}catch(d){e.error(`Failed to run context menu patch on ${m} of caller ${o.caller}.`,d)}},!0);return l}let p=(0,b.forceRender)(l.type)(l.props);if("AnalyticsContext"===p.type.displayName){let q=p.props.children,r=q.type?.displayName,s=f[r];if(!s?.length)return g;for(let t of s)d.default[t.type](t.caller,q,"type",(a,b,c)=>{try{return t.callback.apply(a,[a,b,c])}catch(d){e.error(`Failed to run context menu patch on ${r} of caller ${t.caller}.`,d)}},!0);return q}}catch{}return g})(a,c)},c[1].__unbound=!0}return g.call(a,...c)})}window.__SPLASH__||setImmediate(()=>c.data.available.then(initialize));const g={instead,create,before,after,patches:f}