"use strict";var a;Object.defineProperty(exports,"__esModule",{value:!0}),!function _export(a,b){for(var c in b)Object.defineProperty(a,c,{enumerable:!0,get:b[c]})}(exports,{filters:()=>a,listeners:()=>f,common:()=>g,data:()=>h,addListener:()=>addListener,removeListener:()=>removeListener,find:()=>find,findByIndex:()=>findByIndex,findLazy:()=>findLazy,findByProps:()=>findByProps,findByPrototypes:()=>findByPrototypes,findByKeyword:()=>findByKeyword,findStore:()=>findStore,findByStrings:()=>findByStrings,findByDisplayName:()=>findByDisplayName,bulk:()=>bulk,initialize:()=>initialize,shutdown:()=>shutdown,request:()=>request});const b=require("../../../common/logger"),c=_interopRequireDefault(require("../../../common/data/modules")),d=_interopRequireDefault(require("../../../common/data/splash"));function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}const e=(0,b.createLogger)("Webpack"),f=new Set,g={},h={initialized:!1,available:new Promise(()=>{}),cache:{},global:"webpackChunkdiscord_app",instance:null,push:null,sentry:{blocked:!1,tries:0}};function addListener(a){return f.add(a),removeListener.bind(this,a)}function removeListener(a){return f.delete(a)}function find(...b){let[c,{all:d,cache:f=!0,raw:g=!1,interop:i=!0,initial:j}]=parseOptions(b);if(!c?.length)throw Error("Webpack searches require a filter to search by.");let k=request(!0);if(!k)return;let l=!1,m=j??[],n=a.combine(...c),validate=(a,b)=>{try{return n(a,b)}catch(c){return l||(e.warn("Uncaught Exception with filter. This can cause lag spikes & slow startup times. Please handle any possible null cases in your filter.",c.message),l=!0),!1}},o=f?h.cache:k.c;for(let p in o){let q=k.c[p].exports;if(!(!q||q===window|| ~m.indexOf(i&&q.default?q.default:q))){if("object"==typeof q){if(validate(q,p)){h.cache[p]=k.c[p];let r=g?k.c[p]:q;if(!d)return r;m.push(r)}if(q.default&&validate(q.default,p)){h.cache[p]=k.c[p];let s=g?k.c[p]:i?q.default:q;if(!d)return s;m.push(s)}}else{if(!validate(q,p))continue;h.cache[p]=k.c[p];let t=g?k.c[p]:q;if(!d)return t;m.push(t)}}}return!f||d||m.length?f&&d?find(n,{all:d,raw:g,cache:!1,interop:i,initial:m}):d?m:m[0]:find(n,{all:d,raw:g,cache:!1,interop:i})}function findByIndex(a){if(!h.instance.c[a])try{h.instance.r(a)}catch(b){return null}return h.instance.c[a]}function findLazy(...b){let[c,{all:d=!1,interop:e=!0}]=parseOptions(b),f=find(...c,{all:d,interop:e});if(f)return Promise.resolve(f);let g=a.combine(...c),validate=(a,b)=>{try{return g(a,b)}catch{return!1}},h=[];return new Promise(a=>{let listener=c=>{if(validate(c)&&h.push(c),c.default&&validate(c.default)){let f=e?c.default:c;h.push(f)}h.length&&(a(d?h:h[0]),b())},b=addListener(listener)})}function _find(a,b,c){let{bulk:d,wait:e,...f}=b;return b.bulk?bulk(...a.map(a=>c(...a)),b):e?findLazy(c(...a),f):find(c(...a),f)}function findByProps(...b){let[c,d]=parseOptions(b);return _find(c,d,a.byProps)}function findByPrototypes(...b){let[c,d]=parseOptions(b);return _find(c,d,a.byPrototypes)}function findByKeyword(...a){let[b,{caseSensitive:c=!1,...d}]=parseOptions(a);return _find(b,d,a=>b=>{let d=[...Object.keys(b),...Object.keys(b.__proto__)];for(let e=0;e<d.length;e++){let f=d[e];if(c){if(~f.indexOf(a))return!0}else{let g=a.toLowerCase();if(~f.toLowerCase().indexOf(g))return!0}}return!1})}function findStore(...b){let[c,{short:d=!1,...e}]=parseOptions(b);return _find(c,{short:d,...e},a.byStoreName)}function findByStrings(...b){let[c,{interop:d=!0,...e}]=parseOptions(b);return _find(c,{interop:d,...e},a.byStrings)}function findByDisplayName(...b){let[c,{interop:d=!0,deep:e=!1,exact:f=!0,...g}]=parseOptions(b);return _find(c,{interop:d,...g},b=>a.byDisplayName(b,d,e,f))}function bulk(...b){let[c,{wait:d=!1,...f}]=parseOptions(b);if(!c||!c.length)return;let g=!1,h=Array(c.length),i=d?findLazy:find,j=c.map(b=>{let d=Array.isArray(b)?a.combine(...c):b;return(a,b)=>{try{return d(a,b)}catch(c){return g||(e.warn("Uncaught Exception with filter. This can cause lag spikes & slow startup times. Please handle any possible null cases in your filter.",c.message),g=!0),!1}}}),k=i((a,b)=>{for(let d=0;d<j.length;d++){let e=j[d];"function"==typeof e&&e(a,b)&&null==h[d]&&(h[d]=a)}return h.filter(String).length===c.length},f);return d?k.then(()=>h):h}async function initialize(){if(!h.initialized){if(window.__SPLASH__){let a=Function.prototype.call;await new Promise(b=>{Function.prototype.call=function(...c){try{let d=c[3];d?.c&&d.m&&"__webpack_require__"!==d.name&&(h.instance=d,Function.prototype.call=a,b())}catch(f){e.error("Failed to fetch.",f),Function.prototype.call=a}return a.apply(this,c)}})}else await waitForGlobal(),request(),h.push=window[h.global].push,Object.defineProperty(window[h.global],"push",{configurable:!0,get:()=>onPush,set:a=>h.push=a}),await findLazy(a=>a.popLayer);try{await initializeModules()}catch(b){e.error("Failed to initialize common modules.",b.message)}h.initialized=!0,h.available=Promise.resolve()}}function shutdown(){h.initialized&&(delete window[h.global].push,Object.defineProperty(window[h.global],"push",{configurable:!0,get:()=>h.push,set(a){delete window[h.global].push,window[h.global].push=a}}))}async function initializeModules(){let a=[],b=window.__SPLASH__?d.default:c.default;for(let e in b){let f=c.default[e];if(f.submodule){if(!f.items)continue;let h={};for(let i in f.items){let j=f.items[i],k=handleCommonModule(i,j);k.id=e;let l=k.map;k.map=a=>{let b=l?.(a)??a;return h[i]=b,h},a.push(k)}}else{let m=handleCommonModule(e,f);a.push(m)}}let n=bulk(...a.map(({filter:a})=>a));a.map(({id:a,map:b},c)=>{let d=(b??(a=>a))(n[c]);g[a]=d})}function handleCommonModule(b,c){if(c.storeName)return{id:b,filter:a.byStoreName(c.storeName),map:c.prop?a=>a[c.prop]:null};if(c.props){if(!c.props.every(a=>Array.isArray(a)))return{id:b,filter(b){let d=a.byProps(...c.props)(b);return(!d||!c.ensure||!!c.ensure(b))&&d},map:c.prop?a=>a[c.prop]:null};{let d=[];return{id:b,filter(a){let b=c.props.some(b=>b.every(b=>void 0!==a[b]));return(!b||!c.ensure||!!c.ensure(a))&&(b&&d.push(a),b)},map:()=>Object.assign({},...d)}}}return c.displayName?{id:b,filter:a.byDisplayName(c.displayName,c.default?? !0),map:c.prop?a=>a[c.prop]:null}:c.filter?{id:b,filter:c.filter,map:c.prop?a=>a[c.prop]:null}:void 0}function request(a=!0){if(a&&h.instance)return h.instance;let b=window[h.global].push([[Symbol()],{},a=>a]);return window[h.global].pop(),b&&(h.instance=b),b}function parseOptions(a,b=a=>"object"==typeof a&&!Array.isArray(a),c={}){return[a,b(a[a.length-1])?a.pop():c]}function waitForGlobal(){return window[h.global]?Promise.resolve():new Promise(a=>{Object.defineProperty(window,h.global,{get:()=>void 0,configurable:!0,set(b){delete window[h.global],window[h.global]=b,a()}})})}function onPush(a){let b=a[1];if(h.sentry.tries<5&&!h.sentry.blocked&&(h.sentry.tries++,Object.values(b).find(a=>~a.toString().indexOf("BetterDiscord"))))return h.sentry.blocked=!0;for(let c in b){let d=b[c];b[c]=(...a)=>{let b=a[1];if(d.apply(null,a),f?.size)for(let c of f)try{c(b)}catch(g){e.error("Failed to fire listener.",g)}},Object.assign(b[c],d,{toString:d.toString.bind(d),__original:d})}return Reflect.apply(h.push,window[h.global],[a])}!function(a){a.byProps=function byProps(...a){let filter=a=>"boolean"==typeof a||Array.isArray(a),[b,c]=parseOptions(a,filter,!1),d=c&&"boolean"==typeof c,e=!d&&Array.isArray(c);return a=>{if(d&& void 0===a.default)return!1;for(let f=0,g=b.length;f<g;f++){if(e)for(let h=0,i=c.length;h<i;h++)a=a?.[c[h]];if((d?a.default:a)?.[b[f]]===void 0)return!1}return!0}},a.byPrototypes=function byPrototypes(...a){let filter=a=>"boolean"==typeof a||Array.isArray(a),[b,c]=parseOptions(a,filter,!1),d=c&&"boolean"==typeof c,e=!d&&Array.isArray(c);return a=>{if(d&& void 0===a.default)return!1;for(let f=0,g=b.length;f<g;f++){if(e)for(let h=0,i=c.length;h<i;h++)a=a?.[c[h]];if((d?a.default:a)?.prototype?.[b[f]]===void 0)return!1}return!0}},a.byDisplayName=function byDisplayName(a,b=!0,c=!1,d=!0){return e=>c&&e.type?.displayName?e.type.displayName===a|| !d&& ~e.type.displayName.indexOf(a):c&&e.render?.displayName?e.render.displayName===a|| !d&& ~e.render.displayName.indexOf(a):c&&e.displayName?e.displayName===a|| !d&& ~e.displayName.indexOf(a):b?"function"==typeof e&&e.displayName===a:"function"==typeof e.default&&e.default.displayName===a},a.byStrings=function byStrings(...a){return b=>{if(!b||"function"!=typeof b||(b.__original?.toString??b.toString)!==Function.prototype.toString)return!1;for(let c=0,d=a.length;c<d;c++)if(!~b.toString?.()?.indexOf?.(a[c]))return!1;return!0}},a.byStoreName=function byStoreName(a,b=!0){return c=>c.getName?.()===(b&&!a.endsWith("Store")?`${a}Store`:a)},a.combine=function combine(...a){return(b,c)=>{for(let d=0,e=a.length;d<e;d++)if(!a[d](b,c))return!1;return!0}},a.inverse=function inverse(a){return(b,c)=>!a(b,c)},a.traverse=function traverse(a,b){return(c,d)=>{if(Array.isArray(b))for(let e=0,f=b.length;e<f;e++){let g=c[b[e]];if(void 0===g)return!1;c=g}else{let h=c[b];if(void 0===h)return!1;c=h}return a(c,d)}}}(a||(a={}))