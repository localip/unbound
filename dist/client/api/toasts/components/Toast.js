"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"default",{enumerable:!0,get:()=>Toast});const a=require("../../../modules/webpack/common"),b=require("../../../components/discord"),c=_interopRequireDefault(require("../../../structures/component")),d=require("../../../components/index"),e=_interopRequireDefault(require("../../../modules/react"));function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}const f=a.MarkdownParser?.reactParserFor?.(a.MarkdownParser.defaultRules),{useSpring:g,useTransition:h,animated:i}=a.ReactSpring;class Toast extends c.default{constructor(a){super(),this.ref=e.default.createRef(),this.state={closing:a.closing?? !1,hovered:!1}}componentDidUpdate(a){a.closing!==this.props.closing&&this.setState({closing:this.props.closing})}componentDidCatch(){this.setState({crashed:!0})}int2rgba(a,b){return`rgba(${a>>24&255},g: ${a>>16&255},${a>>8&255}, ${b})`}render(){let{icon:a,color:c,title:f,manager:j,content:k,position:l,store:m,id:n,timeout:o,onClose:p,buttons:q,settings:r,onTimeout:s,toastProps:t={}}=this.props;o===1/0&&(o=0),this.state.crashed&&(f="This toast failed to render.",a="CloseCircle",c="var(--info-danger-foreground)",k="The code that sent this toast is most likely broken.",q=null,p=null,o=null);let u={from:{value:0},to:{value:100},config:a=>"value"===a?{duration:o}:{duration:0}},v=~l.indexOf("top"),w=g(u),x={config:{mass:1,tension:185,friction:26},from:{opacity:1,height:0,marginTop:10,transform:`translateY(${v?"-100%":0}) scale(1)`},enter:()=>a=>a({opacity:1,marginTop:10,height:this.ref.current?.getBoundingClientRect().height??0,transform:"translateY(0) scale(1)"}),leave:{opacity:0,height:0,marginTop:0,transform:"translateY(0) scale(0.75)"},onRest:()=>{this.state.closing&&delete m.storage[n]}},y=h(!this.state.closing,x),z=r.get("toasts.bgColor",0),A=r.get("toasts.bgOpacity",.5);return e.default.createElement(e.default.Fragment,null,y((g,h)=>h&&e.default.createElement(i.div,{key:n,className:"unbound-toast-wrapper",style:{opacity:g.opacity,height:g.height,marginTop:g.marginTop},onMouseEnter(){r.get("toasts.resetTimeoutOnHover",!1)?w.value.to(a=>{w.value.start({config:{mass:1,tension:500,friction:50,clamp:!0},from:a,to:0})}):w.value.pause()},onMouseLeave(){r.get("toasts.resetTimeoutOnHover",!1)?w.value.start(u):w.value.resume()}},e.default.createElement(i.div,Object.assign({ref:this.ref,"data-color":c,"data-use-custom":r.get("toasts.useCustomColours",!1),style:{transform:g.transform,"--color":c,"--bg":this.int2rgba(z,A),"--blur":`${r.get("toasts.blurAmount",7.5)}px`},className:"unbound-toast"},t),e.default.createElement("div",{style:{padding:o>0?"10px 10px 6.5px 10px":10}},e.default.createElement("div",{className:"unbound-toast-header","data-has-content":Boolean(k)},"function"==typeof a&&e.default.createElement(a,{className:"unbound-toast-icon"})||"string"==typeof a&&e.default.createElement(d.Icon,{className:"unbound-toast-icon",name:a}),f&&e.default.createElement(b.FormTitle,{className:"unbound-toast-title",tag:"h3"},"function"==typeof f&&e.default.createElement(f,null)||"string"==typeof f&&this.parse(f)),e.default.createElement(d.Icon,{className:"unbound-toast-close",name:"Close",onClick(){j.close(n),p?.()},onContextMenu(){j.closeAll(),p?.()}})),e.default.createElement(b.Text,{className:"unbound-toast-content"},"function"==typeof k&&e.default.createElement(k,null)||"string"==typeof k&&this.parse(k)),Array.isArray(q)&&q.length&&e.default.createElement("div",{className:"unbound-toast-buttons"},q.map((a,c)=>e.default.createElement(b.Button,{color:b.Button.Colors[a.color?.toUpperCase()??"BRAND_NEW"],look:b.Button.Looks[a.look?.toUpperCase()||"FILLED"],size:b.Button.Sizes[a.size?.toUpperCase()||"MIN"],key:`button-${c}`,className:"unbound-toast-button",onClick(){a.onClick?.(),(a.close?? !0)&&j.close(n)}},a.text)))),o>0&&e.default.createElement("div",{className:"unbound-toast-progress"},e.default.createElement(i.div,{className:"unbound-toast-progress-bar",style:{width:w.value.to(a=>(a>=100&&0!==o&&!this.state.closing&&(this.setState({closing:!0}),s?.()),`${a}% `))}}))))))}parse(a){try{return f(a)}catch{return a}}}