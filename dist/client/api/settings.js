"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),!function _export(a,b){for(var c in b)Object.defineProperty(a,c,{enumerable:!0,get:b[c]})}(exports,{listeners:()=>f,get:()=>g,toggle:()=>h,set:()=>i,initialize:()=>initialize,shutdown:()=>shutdown,connectComponent:()=>connectComponent,makeStore:()=>makeStore,subscribe:()=>subscribe,unsubscribe:()=>unsubscribe});const a=require("../components/hooks"),b=require("../../common/logger"),c=function _interopRequireWildcard(a,b){if(!b&&a&&a.__esModule)return a;if(null===a||"object"!=typeof a&&"function"!=typeof a)return{default:a};var c=_getRequireWildcardCache(b);if(c&&c.has(a))return c.get(a);var d={},e=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in a)if("default"!==f&&Object.prototype.hasOwnProperty.call(a,f)){var g=e?Object.getOwnPropertyDescriptor(a,f):null;g&&(g.get||g.set)?Object.defineProperty(d,f,g):d[f]=a[f]}return d.default=a,c&&c.set(a,d),d}(require("../../common/settings")),d=function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}(require("react"));function _getRequireWildcardCache(a){if("function"!=typeof WeakMap)return null;var b=new WeakMap,c=new WeakMap;return(_getRequireWildcardCache=function(a){return a?c:b})(a)}const e=(0,b.createLogger)("Settings"),f={},g=c.get,h=c.toggle,i=c.set;function initialize(){c.on("change",onSettingsChange)}function shutdown(){c.off("change",onSettingsChange)}function connectComponent(b,c,e){return f=>{let g=(0,a.useForceUpdate)(),onChange=a=>{(!e||e(a))&&g()};return d.default.useEffect(()=>(subscribe(c,onChange),()=>unsubscribe(c,onChange)),[]),d.default.createElement(b,Object.assign({},f,{settings:makeStore(c)}))}}function makeStore(a){return{settings:c.settings[a]??{},set:(b,c)=>i(a,b,c),get:(b,c)=>g(a,b,c),toggle:(b,c)=>h(a,b,c),subscribe:b=>subscribe(a,b),unsubscribe:b=>unsubscribe(a,b),connectComponent:(b,c)=>connectComponent(b,a,c)}}function subscribe(a,b){f[a]??=new Set,f[a].add(b)}function unsubscribe(a,b){f[a]?.delete(b),f[a]?.size===0&&delete f[a]}function onSettingsChange(a){if(f[a.id])for(let b of[...f[a.id]])try{b(a)}catch(c){e.error("Failed to fire settings listener.",a,c)}}