"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),!function _export(a,b){for(var c in b)Object.defineProperty(a,c,{enumerable:!0,get:b[c]})}(exports,{listeners:()=>f,get:()=>g,toggle:()=>h,set:()=>i,initialize:()=>initialize,shutdown:()=>shutdown,connectComponent:()=>connectComponent,makeStore:()=>makeStore,subscribe:()=>subscribe,unsubscribe:()=>unsubscribe});const a=require("../components/hooks"),b=require("../../common/logger"),c=function _interopRequireWildcard(a,b){if(!b&&a&&a.__esModule)return a;if(null===a||"object"!=typeof a&&"function"!=typeof a)return{default:a};var c=_getRequireWildcardCache(b);if(c&&c.has(a))return c.get(a);var d={},e=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in a)if("default"!==f&&Object.prototype.hasOwnProperty.call(a,f)){var g=e?Object.getOwnPropertyDescriptor(a,f):null;g&&(g.get||g.set)?Object.defineProperty(d,f,g):d[f]=a[f]}return d.default=a,c&&c.set(a,d),d}(require("../../common/settings")),d=function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}(require("react"));function _getRequireWildcardCache(a){if("function"!=typeof WeakMap)return null;var b=new WeakMap,c=new WeakMap;return(_getRequireWildcardCache=function(a){return a?c:b})(a)}const e=(0,b.createLogger)("Settings"),f={},g=c.get,h=c.toggle,i=c.set;function initialize(){c.on("change",onSettingsChange)}function shutdown(){c.off("change",onSettingsChange)}function connectComponent(b,c,e){return f=>{let g=(0,a.useForceUpdate)(),onChange=a=>{(!e||e(a))&&g()};return d.default.useEffect(()=>(subscribe(c,onChange),()=>unsubscribe(c,onChange)),[]),d.default.createElement(b,Object.assign({},f,{settings:makeStore(c)}))}}function makeStore(a){return{settings:c.settings[a]??{},set:(b,c)=>i(a,b,c),get:(b,c)=>g(a,b,c),toggle:(b,c)=>h(a,b,c),subscribe:b=>subscribe(a,b),unsubscribe:b=>unsubscribe(a,b),connectComponent:(b,c)=>connectComponent(b,a,c)}}function subscribe(a,b){f[a]??=new Set,f[a].add(b)}function unsubscribe(a,b){f[a]?.delete(b),f[a]?.size===0&&delete f[a]}function onSettingsChange(a){if(f[a.id])for(let b of[...f[a.id]])try{b(a)}catch(c){e.error("Failed to fire settings listener.",a,c)}}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jbGllbnQvYXBpL3NldHRpbmdzLnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyB1c2VGb3JjZVVwZGF0ZSB9IGZyb20gJ0Bjb21wb25lbnRzL2hvb2tzJztcclxuaW1wb3J0IHsgY3JlYXRlTG9nZ2VyIH0gZnJvbSAnQGNvbW1vbi9sb2dnZXInO1xyXG5pbXBvcnQgKiBhcyBTZXR0aW5ncyBmcm9tICdAY29tbW9uL3NldHRpbmdzJztcclxuaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcclxuXHJcbmNvbnN0IExvZ2dlciA9IGNyZWF0ZUxvZ2dlcignU2V0dGluZ3MnKTtcclxuXHJcbmV4cG9ydCBjb25zdCBsaXN0ZW5lcnMgPSB7fTtcclxuXHJcbmV4cG9ydCBjb25zdCBnZXQgPSBTZXR0aW5ncy5nZXQ7XHJcbmV4cG9ydCBjb25zdCB0b2dnbGUgPSBTZXR0aW5ncy50b2dnbGU7XHJcbmV4cG9ydCBjb25zdCBzZXQgPSBTZXR0aW5ncy5zZXQ7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaW5pdGlhbGl6ZSgpIHtcclxuICAgU2V0dGluZ3Mub24oJ2NoYW5nZScsIG9uU2V0dGluZ3NDaGFuZ2UpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gc2h1dGRvd24oKSB7XHJcbiAgIFNldHRpbmdzLm9mZignY2hhbmdlJywgb25TZXR0aW5nc0NoYW5nZSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjb25uZWN0Q29tcG9uZW50KENvbXBvbmVudDogUmVhY3QuQ29tcG9uZW50VHlwZTxhbnk+LCBpZDogc3RyaW5nLCBwcmVkaWNhdGU/OiBGbik6IFJlYWN0LkZDPGFueT4ge1xyXG4gICByZXR1cm4gKHByb3BzKSA9PiB7XHJcbiAgICAgIGNvbnN0IGZvcmNlVXBkYXRlID0gdXNlRm9yY2VVcGRhdGUoKTtcclxuICAgICAgY29uc3Qgb25DaGFuZ2UgPSAocGF5bG9hZCkgPT4ge1xyXG4gICAgICAgICBpZiAoIXByZWRpY2F0ZSB8fCBwcmVkaWNhdGUocGF5bG9hZCkpIHtcclxuICAgICAgICAgICAgZm9yY2VVcGRhdGUoKTtcclxuICAgICAgICAgfVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgUmVhY3QudXNlRWZmZWN0KCgpID0+IHtcclxuICAgICAgICAgc3Vic2NyaWJlKGlkLCBvbkNoYW5nZSk7XHJcbiAgICAgICAgIHJldHVybiAoKSA9PiB1bnN1YnNjcmliZShpZCwgb25DaGFuZ2UpO1xyXG4gICAgICB9LCBbXSk7XHJcblxyXG4gICAgICByZXR1cm4gPENvbXBvbmVudCB7Li4ucHJvcHN9IHNldHRpbmdzPXttYWtlU3RvcmUoaWQpfSAvPjtcclxuICAgfTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIG1ha2VTdG9yZShpZDogc3RyaW5nKSB7XHJcbiAgIHJldHVybiB7XHJcbiAgICAgIHNldHRpbmdzOiBTZXR0aW5ncy5zZXR0aW5nc1tpZF0gPz8ge30sXHJcbiAgICAgIHNldDogKGtleTogc3RyaW5nLCB2YWx1ZTogYW55KSA9PiBzZXQoaWQsIGtleSwgdmFsdWUpLFxyXG4gICAgICBnZXQ6IChrZXk6IHN0cmluZywgZGVmYXVsdHM6IGFueSkgPT4gZ2V0KGlkLCBrZXksIGRlZmF1bHRzKSxcclxuICAgICAgdG9nZ2xlOiAoa2V5OiBzdHJpbmcsIGRlZmF1bHRzOiBhbnkpID0+IHRvZ2dsZShpZCwga2V5LCBkZWZhdWx0cyksXHJcbiAgICAgIHN1YnNjcmliZTogKGNhbGxiYWNrOiBGbikgPT4gc3Vic2NyaWJlKGlkLCBjYWxsYmFjayksXHJcbiAgICAgIHVuc3Vic2NyaWJlOiAoY2FsbGJhY2s6IEZuKSA9PiB1bnN1YnNjcmliZShpZCwgY2FsbGJhY2spLFxyXG4gICAgICBjb25uZWN0Q29tcG9uZW50OiAoY29tcG9uZW50OiBSZWFjdC5Db21wb25lbnRUeXBlPGFueT4sIHByZWRpY2F0ZT86IEZuKSA9PiBjb25uZWN0Q29tcG9uZW50KGNvbXBvbmVudCwgaWQsIHByZWRpY2F0ZSlcclxuICAgfTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHN1YnNjcmliZShpZDogc3RyaW5nLCBjYWxsYmFjazogRm4pIHtcclxuICAgbGlzdGVuZXJzW2lkXSA/Pz0gbmV3IFNldCgpO1xyXG4gICBsaXN0ZW5lcnNbaWRdLmFkZChjYWxsYmFjayk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiB1bnN1YnNjcmliZShpZDogc3RyaW5nLCBjYWxsYmFjazogRm4pIHtcclxuICAgbGlzdGVuZXJzW2lkXT8uZGVsZXRlKGNhbGxiYWNrKTtcclxuXHJcbiAgIGlmIChsaXN0ZW5lcnNbaWRdPy5zaXplID09PSAwKSB7XHJcbiAgICAgIGRlbGV0ZSBsaXN0ZW5lcnNbaWRdO1xyXG4gICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIG9uU2V0dGluZ3NDaGFuZ2UocGF5bG9hZCkge1xyXG4gICBpZiAoIWxpc3RlbmVyc1twYXlsb2FkLmlkXSkgcmV0dXJuO1xyXG5cclxuICAgZm9yIChjb25zdCBsaXN0ZW5lciBvZiBbLi4ubGlzdGVuZXJzW3BheWxvYWQuaWRdXSkge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgICBsaXN0ZW5lcihwYXlsb2FkKTtcclxuICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICBMb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byBmaXJlIHNldHRpbmdzIGxpc3RlbmVyLicsIHBheWxvYWQsIGUpO1xyXG4gICAgICB9XHJcbiAgIH1cclxufTsiXSwibmFtZXMiOlsibGlzdGVuZXJzIiwiZ2V0IiwidG9nZ2xlIiwic2V0IiwiaW5pdGlhbGl6ZSIsInNodXRkb3duIiwiY29ubmVjdENvbXBvbmVudCIsIm1ha2VTdG9yZSIsInN1YnNjcmliZSIsInVuc3Vic2NyaWJlIiwiTG9nZ2VyIiwiY3JlYXRlTG9nZ2VyIiwiU2V0dGluZ3MiLCJvbiIsIm9uU2V0dGluZ3NDaGFuZ2UiLCJvZmYiLCJDb21wb25lbnQiLCJpZCIsInByZWRpY2F0ZSIsInByb3BzIiwiZm9yY2VVcGRhdGUiLCJ1c2VGb3JjZVVwZGF0ZSIsIm9uQ2hhbmdlIiwicGF5bG9hZCIsIlJlYWN0IiwidXNlRWZmZWN0Iiwic2V0dGluZ3MiLCJrZXkiLCJ2YWx1ZSIsImRlZmF1bHRzIiwiY2FsbGJhY2siLCJjb21wb25lbnQiLCJTZXQiLCJhZGQiLCJkZWxldGUiLCJzaXplIiwibGlzdGVuZXIiLCJlIiwiZXJyb3IiXSwibWFwcGluZ3MiOiJBQUFBLHdLQU9hQSxTQUFTLEtBQVRBLENBQVMsQ0FFVEMsR0FBRyxLQUFIQSxDQUFHLENBQ0hDLE1BQU0sS0FBTkEsQ0FBTSxDQUNOQyxHQUFHLEtBQUhBLENBQUcsQ0FFQUMsVUFBVSxLQUFWQSxVQUFVLENBSVZDLFFBQVEsS0FBUkEsUUFBUSxDQUlSQyxnQkFBZ0IsS0FBaEJBLGdCQUFnQixDQWtCaEJDLFNBQVMsS0FBVEEsU0FBUyxDQVlUQyxTQUFTLEtBQVRBLFNBQVMsQ0FLVEMsV0FBVyxLQUFYQSxXQUFXLG1CQXhESSxxQkFBbUIsWUFDckIscUJBQWdCLHdmQUNuQix1QkFBa0Isc0ZBQzFCLE9BQU8sZ0xBRXpCLE1BQU1DLENBQU0sQ0FBR0MsR0FBQUEsQ0FBWSxhQUFBLEVBQUMsVUFBVSxDQUFDLENBRTFCWCxDQUFTLENBQUcsRUFBRSxDQUVkQyxDQUFHLENBQUdXLENBQVEsQ0FBQ1gsR0FBRyxDQUNsQkMsQ0FBTSxDQUFHVSxDQUFRLENBQUNWLE1BQU0sQ0FDeEJDLENBQUcsQ0FBR1MsQ0FBUSxDQUFDVCxHQUFHLEFBTlMsQUFRakMsVUFBU0MsVUFBVSxFQUFHLENBQzFCUSxDQUFRLENBQUNDLEVBQUUsQ0FBQyxRQUFRLENBQUVDLGdCQUFnQixDQUFDLENBQ3pDLEFBRU0sU0FBU1QsUUFBUSxFQUFHLENBQ3hCTyxDQUFRLENBQUNHLEdBQUcsQ0FBQyxRQUFRLENBQUVELGdCQUFnQixDQUFDLENBQzFDLEFBRU0sU0FBU1IsZ0JBQWdCLENBQUNVLENBQW1DLENBQUVDLENBQVUsQ0FBRUMsQ0FBYyxDQUFpQixDQUM5RyxPQUFPLEFBQUNDLENBQUssRUFBSyxDQUNmLElBQU1DLENBQVcs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