"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),!function _export(a,b){for(var c in b)Object.defineProperty(a,c,{enumerable:!0,get:b[c]})}(exports,{settings:()=>g,set:()=>set,toggle:()=>toggle,get:()=>get,save:()=>save,prependOnceListener:()=>m,prependListener:()=>n,listeners:()=>o,once:()=>p,off:()=>q,on:()=>r});const a=require("./constants"),b=require("events"),c=require("./utilities/index"),d=_interopRequireDefault(require("path")),e=_interopRequireDefault(require("fs"));function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}const f=new b.EventEmitter,g={};e.default.existsSync(a.Paths.storage)||e.default.mkdirSync(a.Paths.storage),e.default.existsSync(a.Paths.settings)||e.default.mkdirSync(a.Paths.settings);const h=d.default.join(a.Paths.settings,a.BuildInfo.releaseChannel);e.default.existsSync(h)||e.default.mkdirSync(h);const i=e.default.readdirSync(h).filter(a=>a.endsWith(".json"));for(const j of i){let k=j.replace(".json","");try{let l=require(d.default.resolve(h,j));g[k]=l}catch{g[k]={}}}function set(a,b,c){g[a]??={};let d={path:b.split("."),res:g[a]};for(let e=0;e<d.path.length-1;e++){let h=d.path[e];d.res[h]??={},d.res=d.res[h]}let i=d.path[d.path.length-1];void 0!==c?d.res[i]=c:delete d.res[i],f.emit("set",{id:a,key:b,value:c}),f.emit("change",{type:"set",id:a,key:b,value:c})}function toggle(a,b,c){let d=!(get(a,b)??c);g[a]??={};let e={path:b.split("."),res:g[a]};for(let h=0;h<e.path.length-1;h++){let i=e.path[h];e.res[i]??={},e.res=e.res[i]}let j=e.path[e.path.length-1];e.res[j]=d,f.emit("toggle",{id:a,key:b,value:d,defaultValue:c}),f.emit("change",{type:"toggle",id:a,key:b,value:d,defaultValue:c})}function get(a,b,c){if(!g[a])return c;let d={path:b.split("."),res:g[a]};for(let e=0;e<d.path.length;e++){let f=d.path[e];if(d.res=d.res[f],!d.res)break}return d.res??c}function save({id:a}){e.default.existsSync(h)||e.default.mkdirSync(h);try{let b=JSON.stringify(g[a],null,2);e.default.writeFileSync(d.default.join(h,`${a}.json`),b)}catch(c){console.error(`Failed to save settings file for ${a}`,c)}}f.on("change",(0,c.debounce)(save,250));const m=f.prependOnceListener.bind(f),n=f.prependListener.bind(f),o=f.listeners.bind(f),p=f.once.bind(f),q=f.off.bind(f),r=f.on.bind(f)